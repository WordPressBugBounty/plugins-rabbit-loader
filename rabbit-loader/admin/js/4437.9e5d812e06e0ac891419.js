"use strict";(this.webpackChunkRLAdmin=this.webpackChunkRLAdmin||[]).push([[4437],{61599(e,t,r){r.d(t,{default:()=>C});var n=r(68430),a=r(63600),o=r(14041),i=r(6530),s=r(15189),c=r(41425),l=r(78722),u=r(34766),d=r(63466),m=r(66066),p=r(92825),h=r(65990),g=r(27502),f=r(24300),y=r(86966),b=r(69597);const x=r.p+"21760721a9db2e6bd620.svg";function v(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function w(e){var t;const r="; ".concat(document.cookie).split("; ".concat(e,"="));if(2===r.length)return null===(t=r.pop())||void 0===t?void 0:t.split(";").shift()}function E(e){var t;let{domainID:n}=e;const a=(0,i.A)(),[E,I]=(0,o.useState)(!1),[S,k]=(0,o.useState)(0),[C,O]=(0,o.useState)(""),[R,j]=(0,o.useState)("connecting"),[_,D]=(0,o.useState)(!1),[W,P]=(0,o.useState)(null),[T,z]=(0,o.useState)(!1),[M,Z]=(0,o.useState)(!1),[L,H]=(0,o.useState)(!1),[J,N]=(0,o.useState)(!1),[F,K]=(0,o.useState)(null),[U,$]=(0,o.useState)(()=>{let e=localStorage.getItem("chatUserId");return e||(e="user_"+Math.random().toString(36).slice(2,11),localStorage.setItem("chatUserId",e)),e}),[q,Y]=(0,o.useState)(()=>{var e,t,r;const n=JSON.parse(null!==(e=localStorage.getItem("user"))&&void 0!==e?e:"{}");return null!==(t=null==n||null===(r=n.state)||void 0===r?void 0:r.email)&&void 0!==t?t:""}),B=(0,o.useMemo)(()=>{var e,t;const r=JSON.parse(null!==(e=localStorage.getItem("rl-selected-dr"))&&void 0!==e?e:"{}");return null!==(t=null==r?void 0:r.host)&&void 0!==t?t:""},[]),[V,G]=(0,o.useState)([{id:1,role:"assistant",text:""!==(null!==(t=w("urauth"))&&void 0!==t?t:"").trim()?"Hello! I'm Rabbit AI, your RabbitLoader assistant. How can I help you today?":"Provide us with your email!",ts:Date.now()}]),Q=(0,o.useRef)(null),X=(0,o.useRef)(null),ee=(0,o.useRef)(null),te=(0,o.useRef)(2);(0,o.useEffect)(()=>{Q.current&&(Q.current.scrollTop=Q.current.scrollHeight)},[V,E,J]),(0,o.useEffect)(()=>{E&&S&&k(0)},[E,S]),(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{j("connecting");const{io:t}=await r.e(6949).then(r.bind(r,96949)).catch(()=>({io:void 0}));if(!t)return void(e||(z(!1),j("no-socket"),ne()));const n=t("https://chat.rabbitloader.com",{path:"/socket.io",transports:["websocket"],timeout:1e4,forceNew:!0});console.log("socket: ",n),X.current=n,z(!0),n.on("connect",()=>{e||j("connected")}),n.on("disconnect",()=>{e||(j("disconnected"),Z(!1))}),n.on("connect_error",()=>{e||j("disconnected")}),n.on("takeover_notice",t=>{e||ae(t)}),n.on("release_notice",t=>{e||oe(t)}),n.on("admin_msg",t=>{e||se("admin",t.text,{adminId:t.adminId||"Joy"})}),n.on("admin_typing_start",()=>{e||N(!0)}),n.on("admin_typing_stop",()=>{e||N(!1)})}catch(t){e||(z(!1),j("no-socket"),ne())}})(),()=>{e=!0,X.current&&(X.current.disconnect(),X.current=null)}},[]);const re=()=>I(e=>!e),ne=()=>{se("system","Chat is running in basic mode. Real-time features are unavailable.")},ae=e=>{D(!0),P((null==e?void 0:e.admin)||(null==e?void 0:e.adminId)||"Joy"),ie("Chat switched to human assistance"),N(!1)},oe=e=>{D(!1),P(null),ie("Chat switched back to AI assistance"),N(!1)},ie=e=>{se("system",e)},se=(e,t,r)=>{const n={id:te.current++,role:e,text:t,ts:Date.now(),adminId:null==r?void 0:r.adminId,sources:null==r?void 0:r.sources};G(e=>[...e,n]),E||"user"===e||k(e=>e+1)},ce=async()=>{const e=C.trim();if(!e||L)return;const t=(()=>{if(!F){const e="session_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2,11));return K(e),e}return F})();if(se("user",e),""===q.trim())return function(e){if(!e)return!1;const t=e.trim();if(t.length>254)return!1;const r=t.indexOf("@");if(r<=0||r===t.length-1)return!1;const n=t.slice(0,r),a=t.slice(r+1).toLowerCase();return!(n.length>64)&&!/\s/.test(t)&&!n.startsWith(".")&&!n.endsWith(".")&&!a.startsWith(".")&&!a.endsWith(".")&&!t.includes("..")&&/^(?!.*\.\.)[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[A-Za-z0-9!#$%&'*+/=?^_`{|}~-]+)*@[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?(?:\.[A-Za-z0-9](?:[A-Za-z0-9-]*[A-Za-z0-9])?)+$/.test("".concat(n,"@").concat(a))}(e)?(Y(e),se("assistant","Hello! I'm Rabbit AI, your RabbitLoader assistant. How can I help you today?")):se("assistant","Please Enter a Valid Email"),void O("");var r;if(T&&((e=>{var t;T&&!M&&null!==(t=X.current)&&void 0!==t&&t.connected&&(X.current.emit("join-session",{sessionId:e,userId:U,userType:"user"}),Z(!0))})(t),null===(r=X.current)||void 0===r||r.emit("user-message",{sessionId:t,message:e,userId:U})),O(""),!_){H(!0),N(!0);try{var a;const r=await fetch("https://chat.rabbitloader.com/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:t,userMsg:e,messageId:Date.now(),ctx:{jwt:null!==(a=(0,b.w9)(!1))&&void 0!==a?a:"",domainId:n,userId:U,email:q,domain:B}})});if(!r.ok)throw new Error("Chat API failed with status: ".concat(r.status));const o=await r.json();o.takeover?se("assistant",o.answer||"A teammate is joining the chat."):o.answer?(se("assistant",o.answer),Array.isArray(o.sources)&&o.sources.length>0&&(e=>{const t=te.current++;G(r=>[...r,{id:t,role:"system",text:"",ts:Date.now(),sources:e}])})(o.sources)):se("assistant",o.error||"No response received")}catch(e){se("assistant","Error: ".concat((null==e?void 0:e.message)||"Could not send message."))}finally{H(!1),N(!1)}}};return(0,o.useEffect)(()=>{var e;if(_&&T&&F&&C)return null===(e=X.current)||void 0===e||e.emit("typing-start",{sessionId:F,userType:"user"}),ee.current&&window.clearTimeout(ee.current),ee.current=window.setTimeout(()=>{var e;null===(e=X.current)||void 0===e||e.emit("typing-stop",{sessionId:F})},1e3),()=>{ee.current&&(window.clearTimeout(ee.current),ee.current=null)}},[C,_,F,T]),(0,o.useMemo)(()=>{switch(R){case"connected":return"Connected";case"disconnected":return"Disconnected";case"connecting":return"Connecting…";case"no-socket":return"Basic Mode"}},[R]),o.createElement(s.A,{sx:{position:"fixed",bottom:16,right:16,zIndex:1300}},o.createElement(c.A,{color:"error",overlap:"circular",badgeContent:S||null,anchorOrigin:{vertical:"top",horizontal:"left"},sx:{mr:.5}},o.createElement(l.A,{onClick:re,color:"primary",sx:{border:3,bgcolor:"#F6F6F6",borderColor:a.palette.primary.main,height:56,width:56,display:"flex",justifyContent:"center",alignItems:"center",boxShadow:3,transition:e=>e.transitions.create(["transform","box-shadow","background-color"],{duration:e.transitions.duration.shorter}),transform:E?"rotate(12deg) scale(1.02)":"none","&:hover":{boxShadow:6,bgcolor:"#ffffff"}}},o.createElement(y.W,{icon:E?"tabler:x":"tabler:message-2-filled",sx:{height:26,width:26}}))),o.createElement(u.A,{in:E,timeout:220},o.createElement(s.A,{sx:{position:"absolute",bottom:70,right:0}},o.createElement(d.A,{direction:"up",in:E,timeout:260,mountOnEnter:!0,unmountOnExit:!0},o.createElement(m.A,{elevation:12,sx:{height:480,width:340,borderRadius:1,overflow:"hidden",bgcolor:"background.paper",border:"1px solid ".concat(a.palette.divider),display:"flex",flexDirection:"column",backdropFilter:"saturate(120%) blur(8px)"}},o.createElement(s.A,{sx:{px:2,py:1.25,display:"flex",alignItems:"center",justifyContent:"space-between",bgcolor:a.palette.primary.main,color:a.palette.primary.contrastText}},o.createElement(p.A,{direction:"row",spacing:1.25,alignItems:"center"},o.createElement(y.W,{icon:"tabler:message-chatbot"}),o.createElement(h.A,{variant:"subtitle1",fontWeight:700,color:"white"},"Chat Support")),o.createElement(p.A,{direction:"row",spacing:1,alignItems:"center"},o.createElement(l.A,{size:"small",onClick:re,sx:{color:"inherit","&:hover":{opacity:.9}}},o.createElement(y.W,{icon:"tabler:chevron-down"})))),o.createElement(s.A,{ref:Q,sx:{flex:1,p:1.5,overflowY:"auto",background:"dark"===a.palette.mode?"rgba(255,255,255,0.02)":"#fafafa","&::-webkit-scrollbar":{width:8},"&::-webkit-scrollbar-thumb":{bgcolor:"text.disabled",borderRadius:8}}},o.createElement(p.A,{spacing:1},V.map(e=>{if("system"===e.role&&(e.text||e.sources))return o.createElement(s.A,{key:e.id,sx:{display:"flex",justifyContent:"center"}},o.createElement(m.A,{elevation:0,sx:{px:1.25,py:.5,bgcolor:a.palette.action.hover,color:"text.secondary",borderRadius:1.5,maxWidth:"90%"}},!!e.text&&o.createElement("span",{dangerouslySetInnerHTML:{__html:v(e.text)}}),e.sources&&e.sources.length>0&&o.createElement(s.A,{sx:{mt:e.text?1:0}},o.createElement(h.A,{variant:"caption",sx:{fontWeight:600}},"Sources:"),o.createElement(p.A,{spacing:.5,mt:.5},e.sources.map((e,t)=>e.url?o.createElement("a",{key:t,href:e.url,target:"_blank",rel:"noreferrer",style:{fontSize:12,textDecoration:"underline"}},e.title,"number"==typeof e.score?" (".concat(Math.round(100*e.score),"% match)"):""):o.createElement(h.A,{key:t,variant:"caption"},e.title,"number"==typeof e.score?" (".concat(Math.round(100*e.score),"% match)"):""))))));const t="user"===e.role,r="user"===e.role?a.palette.primary.light:"admin"===e.role?a.palette.warning.light:a.palette.action.hover;return o.createElement(s.A,{key:e.id,sx:{display:"flex",justifyContent:t?"flex-end":"flex-start",alignItems:"flex-start"}},!t&&o.createElement(s.A,{sx:{width:28,height:28,mr:1,mt:.25}},"assistant"===e.role?o.createElement("img",{src:x,alt:"AI",style:{width:28,height:28}}):"admin"===e.role?o.createElement(s.A,{sx:{width:28,height:28,borderRadius:"50%",bgcolor:a.palette.warning.main,color:a.palette.getContrastText(a.palette.warning.main),fontSize:12,display:"grid",placeItems:"center",fontWeight:700}},(e.adminId||"J").charAt(0).toUpperCase()):null),o.createElement(s.A,{sx:{px:1.25,py:.75,maxWidth:"78%",borderRadius:2,typography:"body2",bgcolor:r,color:t?a.palette.text.primary:"text.primary",boxShadow:t?1:0}},"admin"===e.role&&o.createElement(h.A,{variant:"caption",sx:{color:"primary.dark",fontWeight:600}},e.adminId||"Joy"),o.createElement("div",{dangerouslySetInnerHTML:{__html:v(e.text).replace(/\n/g,"<br />")}})),t&&o.createElement(s.A,{sx:{width:28,height:28,ml:1,mt:.25}},o.createElement(s.A,{sx:{width:28,height:28,borderRadius:"50%",bgcolor:a.palette.grey[400],color:a.palette.getContrastText(a.palette.grey[400]),fontSize:10,display:"grid",placeItems:"center",fontWeight:700}},"You")))}),J&&o.createElement(s.A,{sx:{display:"flex",alignItems:"center"}},o.createElement(s.A,{sx:{width:28,height:28,mr:1}},o.createElement("img",{src:x,alt:"AI",style:{width:28,height:28}})),o.createElement(s.A,{sx:{px:1.25,py:.75,borderRadius:2,bgcolor:a.palette.action.hover}},o.createElement(s.A,{sx:{display:"inline-flex",gap:.6}},o.createElement(A,null),o.createElement(A,null),o.createElement(A,null)))))),o.createElement(g.A,null),o.createElement(s.A,{sx:{p:1}},o.createElement(m.A,{variant:"outlined",sx:{display:"flex",alignItems:"center",px:1,borderRadius:2,opacity:L?.8:1}},o.createElement(f.Ay,{value:C,onChange:e=>O(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ce())},placeholder:"Type a message…",sx:{flex:1,py:1},disabled:L,multiline:!0,maxRows:4}),o.createElement(l.A,{color:"primary",onClick:ce,disabled:!C.trim()||L,sx:{ml:.5}},o.createElement(y.W,{icon:L?"tabler:clock":"tabler:send"}))),o.createElement(p.A,{direction:"row",spacing:1,mt:.75,alignItems:"center"},o.createElement(y.W,{icon:"tabler:shield-check"}),o.createElement(h.A,{variant:"caption",color:"text.secondary"},"We usually reply in a few minutes."))))))))}function A(){return o.createElement(s.A,{sx:{width:6,height:6,borderRadius:"50%",bgcolor:"text.secondary",animation:"pulse 1.2s infinite ease-in-out","@keyframes pulse":{"0%, 80%, 100%":{transform:"scale(0.6)",opacity:.6},"40%":{transform:"scale(1)",opacity:1}}}})}function I(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?I(Object(r),!0).forEach(function(t){k(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):I(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function k(e,t,r){return(t=function(e){var t=function(e){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const C=e=>{let{domainID:t}=e;return React.createElement(a.Z6,{defaultSettings:S(S({},a.L6),{},{primaryColor:"preset1",direction:"ltr",contrast:"hight"})},React.createElement(n.NP,{noSsr:!0,defaultMode:n.q_.defaultMode,modeStorageKey:n.q_.modeStorageKey},React.createElement(E,{domainID:t})))}}}]);